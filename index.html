<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Snake — Juego de Serpiente</title>
<style>
  :root{--bg:#0b0b0b;--snake:#7CFC00;--food:#ff3b3b;--panel:#0f1720}
  html,body{height:100%;margin:0}
  body{background:var(--bg);color:#ddd;font-family:Inter,ui-sans-serif,system-ui,Arial;display:flex;flex-direction:column;align-items:center;gap:12px;padding:18px}
  h1{margin:0;font-size:20px}
  #container{display:flex;gap:18px;align-items:flex-start}
  canvas{background:#000;border:4px solid #111;border-radius:8px;display:block}
  #ui{background:var(--panel);padding:12px;border-radius:8px;min-width:220px;color:#cbd5e1}
  #score{font-size:18px;margin-bottom:8px}
  button{background:#111;color:#fff;border:0;padding:8px 10px;border-radius:6px;cursor:pointer;margin-right:6px}
  .small{padding:6px 8px;font-size:14px}
  #mobile-controls{display:none;margin-top:10px}
  .dir{display:inline-block;padding:12px;border-radius:8px;background:#0b1220;margin:6px;user-select:none}
  #msg{margin-top:8px;font-size:14px;color:#94a3b8}
  @media (max-width:800px){
    #container{flex-direction:column;align-items:center}
    #ui{width:100%;max-width:420px}
    canvas{width:90vw;height:90vw}
    #mobile-controls{display:flex;justify-content:center}
  }
</style>
</head>
<body>
<h1>Snake — Juego de Serpiente</h1>
<div id="container">
  <canvas id="game" width="400" height="400"></canvas>
  <div id="ui">
    <div id="score">Puntaje: <span id="points">0</span></div>
    <div>Mejor: <span id="best">0</span></div>
    <div style="margin-top:10px">
      <button id="btnPause" class="small">Pausar</button>
      <button id="btnRestart" class="small">Reiniciar</button>
      <button id="btnSpeed" class="small">Velocidad: Normal</button>
    </div>
    <div id="msg">Usa flechas / WASD. En móvil: desliza para mover.</div>
    <div id="mobile-controls">
      <div style="display:flex;flex-direction:column;align-items:center">
        <div class="dir" id="up">▲</div>
        <div style="display:flex;gap:6px;align-items:center">
          <div class="dir" id="left">◄</div>
          <div class="dir" id="right">►</div>
        </div>
        <div class="dir" id="down">▼</div>
      </div>
    </div>
  </div>
</div>

<script>
// --- Config ---
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let gridCount = 20; // número de celdas por fila
let cellSize = canvas.width / gridCount;
let snake = [{x: 9, y: 9}];
let dir = {x: 1, y: 0};
let nextDir = {x:1,y:0};
let food = randomFood();
let score = 0;
let speed = 6; // cuadros por segundo
let running = true;
let best = Number(localStorage.getItem('snake_best') || 0);

// UI
const pointsEl = document.getElementById('points');
const bestEl = document.getElementById('best');
const btnPause = document.getElementById('btnPause');
const btnRestart = document.getElementById('btnRestart');
const btnSpeed = document.getElementById('btnSpeed');
bestEl.textContent = best;

// Resize canvas for crisp rendering on different sizes
function resizeCanvas(){
  const size = Math.min(window.innerWidth * 0.6, 520);
  if(window.innerWidth <= 800) canvas.style.width = canvas.style.height = Math.min(window.innerWidth*0.9, 360) + 'px';
  else canvas.style.width = canvas.style.height = size + 'px';
  // keep logical pixel size constant for game math
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function randomFood(){
  const pos = () => Math.floor(Math.random()*gridCount);
  let f;
  do { f = {x: pos(), y: pos()}; } while(snake.some(p=>p.x===f.x && p.y===f.y));
  return f;
}

function draw(){
  // clear
  ctx.fillStyle = '#000';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  cellSize = canvas.width / gridCount;

  // draw food
  ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--food') || '#ff3b3b';
  ctx.fillRect(food.x*cellSize, food.y*cellSize, cellSize-1, cellSize-1);

  // draw snake
  ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--snake') || '#7CFC00';
  for(let i=0;i<snake.length;i++){
    const p = snake[i];
    ctx.fillRect(p.x*cellSize, p.y*cellSize, cellSize-1, cellSize-1);
    // head highlight
    if(i===0){ ctx.strokeStyle='rgba(255,255,255,0.08)'; ctx.strokeRect(p.x*cellSize, p.y*cellSize, cellSize-1, cellSize-1);} 
  }
}

let lastTime = 0;
function loop(ts){
  if(!running){ lastTime = ts; requestAnimationFrame(loop); return; }
  requestAnimationFrame(loop);
  if(!lastTime) lastTime = ts;
  const secs = (ts - lastTime)/1000;
  const interval = 1 / speed;
  if(secs < interval) return;
  lastTime = ts;

  // move
  dir = nextDir;
  const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

  // wrap-around behavior (optional: you can make it die on walls instead)
  if(head.x < 0) head.x = gridCount -1;
  if(head.x >= gridCount) head.x = 0;
  if(head.y < 0) head.y = gridCount -1;
  if(head.y >= gridCount) head.y = 0;

  // collision with self
  if(snake.some(s=>s.x===head.x && s.y===head.y)){
    gameOver();
    return;
  }

  snake.unshift(head);

  // eat food
  if(head.x === food.x && head.y === food.y){
    score++;
    pointsEl.textContent = score;
    food = randomFood();
    // speed up slightly every 5 points
    if(score % 5 === 0) speed = Math.min(20, speed + 1);
  } else {
    snake.pop();
  }

  draw();
}

function gameOver(){
  running = false;
  // update best
  if(score > best){ best = score; localStorage.setItem('snake_best', best); bestEl.textContent = best; }
  setTimeout(()=>{
    if(confirm('Game Over. Puntaje: ' + score + '. ¿Reiniciar?')) restart(); else {
      // pause state: allow restart
    }
  }, 50);
}

function restart(){
  snake = [{x: Math.floor(gridCount/2), y: Math.floor(gridCount/2)}];
  dir = {x:1,y:0}; nextDir = {x:1,y:0};
  food = randomFood(); score = 0; pointsEl.textContent = '0'; speed = 6; running = true;
}

// controls
window.addEventListener('keydown', e=>{
  const k = e.key;
  if(k==='ArrowUp' || k==='w' || k==='W'){ if(dir.y===0) nextDir = {x:0,y:-1}; }
  if(k==='ArrowDown' || k==='s' || k==='S'){ if(dir.y===0) nextDir = {x:0,y:1}; }
  if(k==='ArrowLeft' || k==='a' || k==='A'){ if(dir.x===0) nextDir = {x:-1,y:0}; }
  if(k==='ArrowRight' || k==='d' || k==='D'){ if(dir.x===0) nextDir = {x:1,y:0}; }
  if(k===' '){ running = !running; btnPause.textContent = running ? 'Pausar' : 'Reanudar'; }
});

// UI buttons
btnPause.addEventListener('click', ()=>{ running = !running; btnPause.textContent = running ? 'Pausar' : 'Reanudar'; });
btnRestart.addEventListener('click', restart);
btnSpeed.addEventListener('click', ()=>{
  if(speed <=6){ speed = 10; btnSpeed.textContent = 'Velocidad: Rápida'; }
  else if(speed <=10){ speed = 14; btnSpeed.textContent = 'Velocidad: Muy Rápida'; }
  else { speed = 6; btnSpeed.textContent = 'Velocidad: Normal'; }
});

// mobile swipe support
let touchStart = null;
canvas.addEventListener('touchstart', e=>{ const t = e.touches[0]; touchStart = {x: t.clientX, y: t.clientY}; });
canvas.addEventListener('touchend', e=>{
  if(!touchStart) return;
  const t = e.changedTouches[0];
  const dx = t.clientX - touchStart.x;
  const dy = t.clientY - touchStart.y;
  if(Math.abs(dx) > Math.abs(dy)){
    if(dx > 20 && dir.x===0) nextDir = {x:1,y:0};
    if(dx < -20 && dir.x===0) nextDir = {x:-1,y:0};
  } else {
    if(dy > 20 && dir.y===0) nextDir = {x:0,y:1};
    if(dy < -20 && dir.y===0) nextDir = {x:0,y:-1};
  }
  touchStart = null;
});

// on-screen mobile buttons
['up','down','left','right'].forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('click', ()=>{
    if(id==='up' && dir.y===0) nextDir={x:0,y:-1};
    if(id==='down' && dir.y===0) nextDir={x:0,y:1};
    if(id==='left' && dir.x===0) nextDir={x:-1,y:0};
    if(id==='right' && dir.x===0) nextDir={x:1,y:0};
  });
});

// start
requestAnimationFrame(loop);

</script>
</body>
</html>
